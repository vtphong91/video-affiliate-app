
> video-affiliate-app@0.1.0 dev
> next dev

  â–² Next.js 14.2.21
  - Local:        http://localhost:3000
  - Environments: .env.local

 âœ“ Starting...
 âœ“ Ready in 4.4s
 â—‹ Compiling /dashboard/settings ...
[baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
 âœ“ Compiled /dashboard/settings in 10s (1010 modules)
 âœ“ Compiled in 613ms (465 modules)
 âœ“ Compiled in 1289ms (465 modules)
 â—‹ Compiling /dashboard ...
 âœ“ Compiled /dashboard in 740ms (988 modules)
âœ… Supabase configured, creating real client
âœ… Creating admin client with service role
 GET /dashboard 200 in 1229ms
 â—‹ Compiling /api/dashboard/stats ...
 âœ“ Compiled /api/dashboard/stats in 1581ms (642 modules)
âœ… Supabase configured, creating real client
âœ… Creating admin client with service role
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” db.getReviews called with: {
  userId: '1788ee95-7d22-4b0b-8e45-07ae2d03c7e1',
  status: undefined,
  limit: 10000,
  offset: 0
}
ğŸ” Filtering by user_id: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
âœ… Reviews fetched: 59 reviews
ğŸ“‹ getSchedules: Found 57 schedules (showing 57) for user 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1, status: undefined
ğŸ“Š getSchedulesCount: Found 57 schedules for user 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1, status: undefined
ğŸ” getActivityLogs: Fetching logs from last 48h (since 2025-12-25T09:21:43.640Z)
âœ… Found 2 activity logs in last 48h
 GET /api/dashboard/stats 200 in 3219ms
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” db.getReviews called with: {
  userId: '1788ee95-7d22-4b0b-8e45-07ae2d03c7e1',
  status: undefined,
  limit: 10000,
  offset: 0
}
ğŸ” Filtering by user_id: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
âœ… Reviews fetched: 59 reviews
ğŸ“‹ getSchedules: Found 57 schedules (showing 57) for user 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1, status: undefined
ğŸ“Š getSchedulesCount: Found 57 schedules for user 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1, status: undefined
ğŸ” getActivityLogs: Fetching logs from last 48h (since 2025-12-25T09:21:44.708Z)
âœ… Found 2 activity logs in last 48h
 GET /api/dashboard/stats 200 in 1061ms
 âœ“ Compiled /_not-found in 428ms (1104 modules)
âœ… Supabase configured, creating real client
âœ… Creating admin client with service role
 GET /.well-known/appspecific/com.chrome.devtools.json 404 in 785ms
 âœ“ Compiled in 1414ms (986 modules)
 âœ“ Compiled in 531ms (986 modules)
 â—‹ Compiling / ...
 âœ“ Compiled / in 1572ms (1002 modules)
 GET / 200 in 2031ms
 âœ“ Compiled /api/dashboard/stats in 218ms (650 modules)
âœ… Supabase configured, creating real client
âœ… Creating admin client with service role
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” db.getReviews called with: {
  userId: '1788ee95-7d22-4b0b-8e45-07ae2d03c7e1',
  status: undefined,
  limit: 10000,
  offset: 0
}
ğŸ” Filtering by user_id: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
âœ… Reviews fetched: 59 reviews
ğŸ“‹ getSchedules: Found 57 schedules (showing 57) for user 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1, status: undefined
ğŸ“Š getSchedulesCount: Found 57 schedules for user 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1, status: undefined
ğŸ” getActivityLogs: Fetching logs from last 48h (since 2025-12-25T09:27:12.907Z)
âœ… Found 2 activity logs in last 48h
 GET /api/dashboard/stats 200 in 1306ms
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” db.getReviews called with: {
  userId: '1788ee95-7d22-4b0b-8e45-07ae2d03c7e1',
  status: undefined,
  limit: 10000,
  offset: 0
}
ğŸ” Filtering by user_id: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
âœ… Reviews fetched: 59 reviews
ğŸ“‹ getSchedules: Found 57 schedules (showing 57) for user 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1, status: undefined
ğŸ“Š getSchedulesCount: Found 57 schedules for user 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1, status: undefined
ğŸ” getActivityLogs: Fetching logs from last 48h (since 2025-12-25T09:27:13.718Z)
âœ… Found 2 activity logs in last 48h
 GET /api/dashboard/stats 200 in 797ms
 â—‹ Compiling /admin ...
 âœ“ Compiled /admin in 731ms (1148 modules)
 â—‹ Compiling /admin/affiliate-settings ...
 âœ“ Compiled /admin/affiliate-settings in 1689ms (1304 modules)
 âœ“ Compiled /api/admin/merchants in 335ms (754 modules)
 âœ“ Compiled (757 modules)
âœ… Supabase configured, creating real client
âœ… Creating admin client with service role
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/affiliate-settings 200 in 1227ms
 GET /api/admin/merchants 200 in 1251ms
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/affiliate-settings 200 in 241ms
 GET /api/admin/merchants 200 in 250ms
ğŸ”§ PATCH /api/admin/affiliate-settings - Starting...
ğŸ“‹ Headers: {
  authorization: null,
  cookie: 'authjs.session-token=eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2Q0JDLUhTNTEyIiwia2lkIjoiVHBQLUQ2RW5xZlAtdlZ2RlZ...'
}
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ‘¤ User ID from request: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” Checking permissions for user: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
âœ… Has permission: true
ğŸ“¦ Request body: {
  api_token: '***REDACTED***',
  api_url: 'https://api.accesstrade.vn/v1',
  link_mode: 'api',
  publisher_id: '',
  utm_source: 'video-affiliate',
  utm_campaign: 'review'
}
ğŸ” Encrypting API token...
 PATCH /api/admin/affiliate-settings 200 in 531ms
 âœ“ Compiled in 2.4s (1321 modules)
 âœ“ Compiled in 463ms (636 modules)
 âœ“ Compiled in 1660ms (1205 modules)
 GET /admin/affiliate-settings 200 in 370ms
 â—‹ Compiling /api/admin/merchants ...
 âœ“ Compiled /api/admin/merchants in 802ms (752 modules)
 âœ“ Compiled in 2ms (755 modules)
 âœ“ Compiled in 0ms (755 modules)
 âœ“ Compiled in 1ms (755 modules)
âœ… Supabase configured, creating real client
âœ… Creating admin client with service role
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
âœ… Supabase configured, creating real client
âœ… Creating admin client with service role
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/affiliate-settings 200 in 5627ms
 GET /api/admin/merchants 200 in 5668ms
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/affiliate-settings 200 in 269ms
 GET /api/admin/merchants 200 in 261ms
 âœ“ Compiled in 2.6s (1205 modules)
 âœ“ Compiled in 1544ms (1205 modules)
 âœ“ Compiled /api/admin/merchants in 455ms (752 modules)
 âœ“ Compiled (755 modules)
âœ… Supabase configured, creating real client
âœ… Creating admin client with service role
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/affiliate-settings 200 in 1377ms
 GET /api/admin/merchants 200 in 1413ms
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/affiliate-settings 200 in 280ms
 GET /api/admin/merchants 200 in 281ms
 âœ“ Compiled in 2s (1324 modules)
 âœ“ Compiled in 1420ms (1324 modules)
 GET /admin/affiliate-settings 200 in 481ms
âœ… Supabase configured, creating real client
âœ… Creating admin client with service role
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/merchants 200 in 496ms
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/affiliate-settings 200 in 567ms
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/merchants 200 in 227ms
 GET /api/admin/affiliate-settings 200 in 239ms
 âœ“ Compiled in 2.3s (1324 modules)
âœ… Supabase configured, creating real client
âœ… Creating admin client with service role
ğŸ”§ PATCH /api/admin/affiliate-settings - Starting...
ğŸ“‹ Headers: {
  authorization: null,
  cookie: 'authjs.session-token=eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2Q0JDLUhTNTEyIiwia2lkIjoiVHBQLUQ2RW5xZlAtdlZ2RlZ...'
}
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ‘¤ User ID from request: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” Checking permissions for user: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
âœ… Has permission: true
ğŸ“¦ Request body: {
  api_url: 'https://api.accesstrade.vn/v1',
  link_mode: 'api',
  utm_source: 'video-affiliate',
  utm_campaign: 'review',
  api_token: '***REDACTED***',
  publisher_id: '4790392958945222748'
}
ğŸ” Encrypting API token...
ğŸ” Encrypting publisher_id...
Update affiliate settings error: Error: Failed to update settings: value too long for type character varying(50)
    at AffiliateSettingsService.updateSettings (webpack-internal:///(rsc)/./lib/affiliate/services/settings-service.ts:94:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async PATCH (webpack-internal:///(rsc)/./app/api/admin/affiliate-settings/route.ts:127:25)
    at async F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\compiled\next-server\app-route.runtime.dev.js:6:57228
    at async eT.execute (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\compiled\next-server\app-route.runtime.dev.js:6:46851)
    at async eT.handle (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\compiled\next-server\app-route.runtime.dev.js:6:58562)
    at async doRender (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:1353:42)
    at async cacheEntry.responseCache.get.routeKind (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:1575:28)
    at async DevServer.renderToResponseWithComponentsImpl (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:1483:28)
    at async DevServer.renderPageComponent (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:1911:24)
    at async DevServer.renderToResponseImpl (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:1949:32)
    at async DevServer.pipeImpl (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:921:25)
    at async NextNodeServer.handleCatchallRenderRequest (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\next-server.js:272:17)
    at async DevServer.handleRequestImpl (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:817:17)
    at async F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\dev\next-dev-server.js:339:20
    at async Span.traceAsyncFn (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\trace\trace.js:154:20)
    at async DevServer.handleRequest (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\dev\next-dev-server.js:336:24)
    at async invokeRender (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\lib\router-server.js:173:21)
    at async handleRequest (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\lib\router-server.js:350:24)
    at async requestHandlerImpl (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\lib\router-server.js:374:13)
    at async Server.requestListener (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\lib\start-server.js:141:13)
 PATCH /api/admin/affiliate-settings 500 in 762ms
 âœ“ Compiled in 1496ms (1321 modules)
 â—‹ Compiling /_not-found ...
 âœ“ Compiled /_not-found in 1945ms (1310 modules)
 GET /.well-known/appspecific/com.chrome.devtools.json 404 in 2622ms
âœ… Supabase configured, creating real client
âœ… Creating admin client with service role
ğŸ”§ PATCH /api/admin/affiliate-settings - Starting...
ğŸ“‹ Headers: {
  authorization: null,
  cookie: 'authjs.session-token=eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2Q0JDLUhTNTEyIiwia2lkIjoiVHBQLUQ2RW5xZlAtdlZ2RlZ...'
}
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ‘¤ User ID from request: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” Checking permissions for user: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
âœ… Has permission: true
ğŸ“¦ Request body: {
  api_url: 'https://api.accesstrade.vn/v1',
  link_mode: 'api',
  utm_source: 'video-affiliate',
  utm_campaign: 'review',
  api_token: '***REDACTED***',
  publisher_id: '4790392958945222748'
}
ğŸ” Encrypting API token...
ğŸ” Encrypting publisher_id...
Update affiliate settings error: Error: Failed to update settings: value too long for type character varying(50)
    at AffiliateSettingsService.updateSettings (webpack-internal:///(rsc)/./lib/affiliate/services/settings-service.ts:94:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async PATCH (webpack-internal:///(rsc)/./app/api/admin/affiliate-settings/route.ts:127:25)
    at async F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\compiled\next-server\app-route.runtime.dev.js:6:57228
    at async eT.execute (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\compiled\next-server\app-route.runtime.dev.js:6:46851)
    at async eT.handle (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\compiled\next-server\app-route.runtime.dev.js:6:58562)
    at async doRender (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:1353:42)
    at async cacheEntry.responseCache.get.routeKind (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:1575:28)
    at async DevServer.renderToResponseWithComponentsImpl (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:1483:28)
    at async DevServer.renderPageComponent (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:1911:24)
    at async DevServer.renderToResponseImpl (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:1949:32)
    at async DevServer.pipeImpl (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:921:25)
    at async NextNodeServer.handleCatchallRenderRequest (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\next-server.js:272:17)
    at async DevServer.handleRequestImpl (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:817:17)
    at async F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\dev\next-dev-server.js:339:20
    at async Span.traceAsyncFn (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\trace\trace.js:154:20)
    at async DevServer.handleRequest (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\dev\next-dev-server.js:336:24)
    at async invokeRender (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\lib\router-server.js:173:21)
    at async handleRequest (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\lib\router-server.js:350:24)
    at async requestHandlerImpl (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\lib\router-server.js:374:13)
    at async Server.requestListener (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\lib\start-server.js:141:13)
 PATCH /api/admin/affiliate-settings 500 in 656ms
 âœ“ Compiled in 1053ms (571 modules)
 GET /admin/affiliate-settings 200 in 202ms
 GET /.well-known/appspecific/com.chrome.devtools.json 404 in 121ms
ğŸ” Getting session from Supabase...
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 â—‹ Compiling /api/admin/merchants ...
 âœ“ Compiled /api/admin/merchants in 711ms (756 modules)
âœ… Supabase configured, creating real client
âœ… Creating admin client with service role
ğŸ” Getting session from Supabase...
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/affiliate-settings 200 in 1115ms
 GET /api/admin/affiliate-settings 200 in 1136ms
 GET /api/admin/merchants 200 in 1191ms
 GET /api/admin/merchants 200 in 1282ms
 GET /admin/affiliate-settings 200 in 512ms
 GET /.well-known/appspecific/com.chrome.devtools.json 404 in 106ms
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/affiliate-settings 200 in 643ms
 GET /api/admin/merchants 200 in 659ms
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/affiliate-settings 200 in 351ms
 GET /api/admin/merchants 200 in 346ms
ğŸ”§ PATCH /api/admin/affiliate-settings - Starting...
ğŸ“‹ Headers: {
  authorization: null,
  cookie: 'authjs.session-token=eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2Q0JDLUhTNTEyIiwia2lkIjoiVHBQLUQ2RW5xZlAtdlZ2RlZ...'
}
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ‘¤ User ID from request: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” Checking permissions for user: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
âœ… Has permission: true
ğŸ“¦ Request body: {
  api_url: 'https://api.accesstrade.vn/v1',
  link_mode: 'api',
  utm_source: 'video-affiliate',
  utm_campaign: 'review',
  api_token: '***REDACTED***',
  publisher_id: '4790392958945222748'
}
ğŸ” Encrypting API token...
ğŸ” Encrypting publisher_id...
Update affiliate settings error: Error: Failed to update settings: value too long for type character varying(50)
    at AffiliateSettingsService.updateSettings (webpack-internal:///(rsc)/./lib/affiliate/services/settings-service.ts:94:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async PATCH (webpack-internal:///(rsc)/./app/api/admin/affiliate-settings/route.ts:127:25)
    at async F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\compiled\next-server\app-route.runtime.dev.js:6:57228
    at async eT.execute (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\compiled\next-server\app-route.runtime.dev.js:6:46851)
    at async eT.handle (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\compiled\next-server\app-route.runtime.dev.js:6:58562)
    at async doRender (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:1353:42)
    at async cacheEntry.responseCache.get.routeKind (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:1575:28)
    at async DevServer.renderToResponseWithComponentsImpl (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:1483:28)
    at async DevServer.renderPageComponent (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:1911:24)
    at async DevServer.renderToResponseImpl (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:1949:32)
    at async DevServer.pipeImpl (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:921:25)
    at async NextNodeServer.handleCatchallRenderRequest (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\next-server.js:272:17)
    at async DevServer.handleRequestImpl (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\base-server.js:817:17)
    at async F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\dev\next-dev-server.js:339:20
    at async Span.traceAsyncFn (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\trace\trace.js:154:20)
    at async DevServer.handleRequest (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\dev\next-dev-server.js:336:24)
    at async invokeRender (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\lib\router-server.js:173:21)
    at async handleRequest (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\lib\router-server.js:350:24)
    at async requestHandlerImpl (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\lib\router-server.js:374:13)
    at async Server.requestListener (F:\VSCODE\AUTOPOSTFACEBOOK\video-affiliate-app\node_modules\next\dist\server\lib\start-server.js:141:13)
 PATCH /api/admin/affiliate-settings 500 in 633ms
 GET /admin/affiliate-settings 200 in 127ms
 GET /.well-known/appspecific/com.chrome.devtools.json 404 in 77ms
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/merchants 200 in 480ms
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/affiliate-settings 200 in 546ms
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/merchants 200 in 239ms
 GET /api/admin/affiliate-settings 200 in 222ms
ğŸ”§ PATCH /api/admin/affiliate-settings - Starting...
ğŸ“‹ Headers: {
  authorization: null,
  cookie: 'authjs.session-token=eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2Q0JDLUhTNTEyIiwia2lkIjoiVHBQLUQ2RW5xZlAtdlZ2RlZ...'
}
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ‘¤ User ID from request: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” Checking permissions for user: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
âœ… Has permission: true
ğŸ“¦ Request body: {
  api_url: 'https://api.accesstrade.vn/v1',
  link_mode: 'api',
  utm_source: 'video-affiliate',
  utm_campaign: 'review',
  api_token: '***REDACTED***',
  publisher_id: '4790392958945222748'
}
ğŸ” Encrypting API token...
ğŸ” Encrypting publisher_id...
 PATCH /api/admin/affiliate-settings 200 in 565ms
 â—‹ Compiling /api/admin/affiliate-settings/test ...
 âœ“ Compiled /api/admin/affiliate-settings/test in 612ms (758 modules)
âœ… Supabase configured, creating real client
âœ… Creating admin client with service role
ğŸ§ª POST /api/admin/affiliate-settings/test - Starting...
ğŸ“‹ Headers: {
  authorization: null,
  cookie: 'authjs.session-token=eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2Q0JDLUhTNTEyIiwia2lkIjoiVHBQLUQ2RW5xZlAtdlZ2RlZ...'
}
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ‘¤ User ID from request: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” Checking permissions for user: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
âœ… Has permission: true
ğŸ”‘ Using existing token from database...
ğŸ§ª Testing AccessTrade API connection... {
  api_url: 'https://api.accesstrade.vn/v1',
  token_preview: '1BIuwwkz...',
  using_existing: true
}
ğŸ§ª API test result: {
  success: false,
  message: 'API test failed: Campaign does not exists or not running',
  details: {
    message: 'Campaign does not exists or not running',
    status: false,
    status_code: '03'
  }
}
 POST /api/admin/affiliate-settings/test 200 in 1545ms
 âœ“ Compiled in 850ms (754 modules)
 âœ“ Compiled in 653ms (636 modules)
 GET /admin/affiliate-settings 200 in 428ms
 â—‹ Compiling /_not-found ...
 âœ“ Compiled /_not-found in 1103ms (1194 modules)
 GET /.well-known/appspecific/com.chrome.devtools.json 404 in 1420ms
 âœ“ Compiled /api/admin/merchants in 410ms (753 modules)
 âœ“ Compiled in 1ms (756 modules)
 âœ“ Compiled in 0ms (756 modules)
 âœ“ Compiled in 1ms (756 modules)
âœ… Supabase configured, creating real client
âœ… Creating admin client with service role
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
âœ… Supabase configured, creating real client
âœ… Creating admin client with service role
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/affiliate-settings 200 in 5372ms
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/merchants 200 in 5440ms
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/merchants 200 in 227ms
 GET /api/admin/affiliate-settings 200 in 321ms
 âœ“ Compiled /api/admin/merchants/[id] in 345ms (758 modules)
âœ… Supabase configured, creating real client
âœ… Creating admin client with service role
âœ… Supabase configured, creating real client
âœ… Creating admin client with service role
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 DELETE /api/admin/merchants/93431729-a933-4748-b8d7-9b43689d3247 200 in 4771ms
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/merchants 200 in 331ms
 â—‹ Compiling /api/admin/affiliate-settings/test ...
 âœ“ Compiled /api/admin/affiliate-settings/test in 571ms (760 modules)
âœ… Supabase configured, creating real client
âœ… Creating admin client with service role
ğŸ§ª POST /api/admin/affiliate-settings/test - Starting...
ğŸ“‹ Headers: {
  authorization: null,
  cookie: 'authjs.session-token=eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2Q0JDLUhTNTEyIiwia2lkIjoiVHBQLUQ2RW5xZlAtdlZ2RlZ...'
}
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ‘¤ User ID from request: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
ğŸ” Checking permissions for user: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
âœ… Has permission: true
ğŸ”‘ Using existing token from database...
ğŸ§ª Testing AccessTrade API connection... {
  api_url: 'https://api.accesstrade.vn/v1',
  token_preview: '1BIuwwkz...',
  using_existing: true
}
ğŸ§ª API test result: {
  success: true,
  message: 'Káº¿t ná»‘i API thÃ nh cÃ´ng! Token há»£p lá»‡.',
  details: {
    note: 'API token Ä‘Ã£ Ä‘Æ°á»£c xÃ¡c thá»±c thÃ nh cÃ´ng vá»›i AccessTrade.',
    response_status: 200
  }
}
 POST /api/admin/affiliate-settings/test 200 in 3280ms
ğŸ” Getting session from Supabase...
Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server.
âœ… Got user from Supabase session: 1788ee95-7d22-4b0b-8e45-07ae2d03c7e1
 GET /api/admin/affiliate-settings 200 in 255ms
